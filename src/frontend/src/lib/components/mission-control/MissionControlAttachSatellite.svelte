<script lang="ts">
	import CanisterAttach from '$lib/components/canister/CanisterAttach.svelte';
	import IconLink from '$lib/components/icons/IconLink.svelte';
	import { Principal } from '@dfinity/principal';
	import { attachSatellite } from '$lib/services/mission-control.services';
	import { i18n } from '$lib/stores/i18n.store';
	import { createEventDispatcher } from 'svelte';
	import { toasts } from '$lib/stores/toasts.store';
	import { i18nCapitalize, i18nFormat } from '$lib/utils/i18n.utils';

	let visible = false;

	const setSatellite = async ({
		missionControlId,
		canisterId
	}: {
		missionControlId: Principal;
		canisterId: Principal;
	}) => {
		await attachSatellite({
			missionControlId,
			satelliteId: canisterId
		});
	};

	const dispatch = createEventDispatcher();

	const onSuccess = () => {
		toasts.success(
			i18nCapitalize(
				i18nFormat($i18n.canisters.attach_success, [
					{
						placeholder: '{0}',
						value: 'satellite'
					}
				])
			)
		);

		dispatch('junoAttach');
	};
</script>

<button on:click={() => (visible = true)} class="menu"
	><IconLink /> {$i18n.satellites.attach}</button
>

<CanisterAttach on:junoAttach={onSuccess} bind:visible setFn={setSatellite}>
	<svelte:fragment slot="title">{$i18n.satellites.attach}</svelte:fragment>
	<svelte:fragment slot="input">{$i18n.satellites.id}</svelte:fragment>
</CanisterAttach>
